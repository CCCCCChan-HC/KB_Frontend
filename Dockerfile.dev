# Dockerfile for Development Environment
FROM --platform=linux/amd64 node:18-bullseye-slim

WORKDIR /app

# Set NODE_ENV to development
# This is the most critical step. It tells Next.js to run in development mode.
ENV NODE_ENV=development

# Using Alibaba Cloud mirror for faster package installation
RUN echo 'deb http://mirrors.aliyun.com/debian/ bullseye main non-free contrib' > /etc/apt/sources.list && \
    echo 'deb http://mirrors.aliyun.com/debian-security bullseye-security main' >> /etc/apt/sources.list && \
    echo 'deb http://mirrors.aliyun.com/debian/ bullseye-updates main non-free contrib' >> /etc/apt/sources.list && \
    apt-get update && apt-get install -y --no-install-recommends curl && \
    rm -rf /var/lib/apt/lists/*

COPY . .

# Use npm and set network retry settings
RUN npm config set registry https://registry.npmmirror.com/
RUN npm config set fetch-timeout 300000
RUN npm config set fetch-retry-mintimeout 20000
RUN npm config set fetch-retry-maxtimeout 120000
RUN npm install

# Expose port 3000
EXPOSE 3000

# The command to start the development server
# We use "npm run dev" instead of "npm run build" and "node server.js"
CMD ["npm", "run", "dev"]